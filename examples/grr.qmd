---
title: "GRR"
format: html
editor_options: 
  chunk_output_type: console
---

```{r}
#| message: false

library(tidyverse)

source(here::here("R", "hist_grr.R"))
source(here::here("R", "add_D_i.R"))
source(here::here("R", "add_opt_in.R"))
source(here::here("R", "create_D.R"))

```

Let's create a simple example with two variables from the diamonds data set. The cardinality of the cartesian product is 35 but we drop an observed combination to ensure that the combination is included in the noisy data. 

```{r}
data <- diamonds %>%
  select(cut, color) %>%
  mutate(across(everything(), as.character)) %>%
  filter(!(cut == "Fair" & color == "D")) %>%
  mutate(state = "Fake state")

attribs <- c("cut", "color", "state")

```

`add_D_i()` and `create_D()` are important functions for ensuring the missing combinations are included. 

```{r}
add_D_i(data, attribs = attribs)
create_D(data)


```

Demonstrate the method with $\epsilon = 1$ and $\epsilon = 10$.

```{r}
data %>%
  add_D_i(attribs = attribs) %>%
  add_opt_in(prob_opt_in = 1) %>%
  hist_grr(epsilon = 1, attribs = attribs)

data %>%
  add_D_i(attribs = attribs) %>%
  add_opt_in(prob_opt_in = 1) %>%
  hist_grr(epsilon = 10, attribs = attribs)

```
